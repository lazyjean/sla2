# 开发指南

本文档包含项目开发过程中的重要命令和最佳实践。开发人员应仔细阅读并遵循这些指导原则，以确保项目代码质量和一致性。

## 构建和测试

### 测试命令

使用以下命令运行项目测试：

```bash
make test
```

此命令会执行所有测试并报告结果。确保在提交代码前所有测试都能通过。

如果需要运行特定包的测试，可以使用：

```bash
go test -v ./internal/application/service/...
```

### 构建命令

使用以下命令构建项目：

```bash
make build
```

## 代码生成

### Wire 依赖注入生成

项目使用 Google Wire 进行依赖注入。修改依赖关系后，必须重新生成代码：

```bash
make generate
```

或直接在 wire 目录中执行：

```bash
cd internal/wire
wire
```

NOTE: 所有的注入逻辑统一写到 wire.go 中

**重要提示：不要手动编辑 `wire_gen.go` 文件！这是自动生成的文件，应该通过 `go generate` 命令更新。**

### Protocol Buffers 生成

当修改了 proto 文件后，必须重新生成相关的 Go 代码：

```bash
make proto
```

**重要提示：不要手动编辑任何以下文件，这些都是自动生成的：**
- `*.pb.go`
- `*_grpc.pb.go`
- `*.pb.gw.go`

## 架构规范

### 项目结构

项目遵循领域驱动设计 (DDD) 和干净架构原则，主要分为以下几层：

- **domain**: 包含核心业务逻辑、实体和接口定义
- **application**: 包含应用服务，协调领域对象完成用例
- **infrastructure**: 包含技术实现细节，如数据库访问
- **interfaces**: 包含与外部系统交互的接口，如 gRPC 服务

### 最佳实践

1. **遵循单一职责原则**: 每个组件应该只有一个变更的理由
2. **使用依赖注入**: 通过 Wire 框架管理依赖
3. **编写单元测试**: 每个功能都应该有对应的单元测试
4. **保持代码简洁**: 遵循 Go 的代码风格和最佳实践

## 常见问题解决

### 测试数据库

测试需要一个测试数据库。确保在运行测试前已经创建了 `sla2_test` 数据库

## LLM 提示词上下文管理

项目中使用 LLM (Language Model) 相关的提示词和上下文应当保存在 `prompts` 目录中。使用标准化的格式和命名约定，以便于维护和更新。

### 提示词文件结构

每个提示词文件应该包含：

1. **描述**: 这个提示词的用途
2. **变量**: 提示词中可以被替换的变量
3. **示例**: 如何使用这个提示词的示例

### 使用规范

- 在代码中引用提示词时，使用常量而非硬编码字符串
- 定期审查和优化提示词以提高效果
- 记录提示词的版本和变更历史